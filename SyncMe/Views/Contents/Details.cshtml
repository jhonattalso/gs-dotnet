@model SyncMe.Models.Content
@using SyncMe.Models
@using System.Text.RegularExpressions

@{
    ViewData["Title"] = "Detalhes do Artigo";
}

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">

            <a asp-action="Index" class="btn btn-outline-secondary mb-4">&larr; Voltar para a lista</a>

            <article>
                <header class="mb-4">
                    <h1 class="fw-bolder mb-1">@Model.Title</h1>
                    <div class="text-muted fst-italic mb-2">Postado em @Model.PublishDate.ToString("dd/MM/yyyy") por Admin</div>
                    <span class="badge bg-primary text-decoration-none link-light">@Model.Category?.Name</span>
                    <span class="badge bg-secondary text-decoration-none link-light">@Model.Difficulty</span>
                </header>

                <figure class="mb-4">
                    @{
                        var youtubeEmbed = GetYouTubeEmbedLink(Model.MediaUrl);
                    }

                    @if (!string.IsNullOrEmpty(Model.CoverImageUrl)) {
                        <img class="img-fluid rounded" src="@Model.CoverImageUrl" alt="Capa do Artigo" style="width:100%; max-height: 500px; object-fit: cover;" />
                    }
                    else if (youtubeEmbed != null) {
                        <div class="ratio ratio-16x9">
                            <iframe src="@youtubeEmbed" allowfullscreen></iframe>
                        </div>
                    }
                </figure>

                <section class="mb-5 article-content">
                    @if (!string.IsNullOrEmpty(Model.ArticleBody)) {
                        <p class="fs-5 mb-4" style="white-space: pre-wrap;">@Model.ArticleBody</p>
                    }
                    else {
                        <p class="fs-5 mb-4">@Model.Summary</p>
                    }
                </section>

                @if (!string.IsNullOrEmpty(Model.CoverImageUrl) && youtubeEmbed != null) {
                    <hr />
                    <h4 class="mt-4">Vídeo Complementar</h4>
                    <div class="ratio ratio-16x9 mt-3">
                        <iframe src="@youtubeEmbed" allowfullscreen></iframe>
                    </div>
                }

            </article>
        </div>
    </div>
</div>

@functions {
    public string? GetYouTubeEmbedLink(string? url) { /* Mesma função do Index */
        if (string.IsNullOrEmpty(url)) return null;
        var regex = new Regex(@"(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^""&?\/\s]{11})");
        var match = regex.Match(url);
        return match.Success ? $"https://www.youtube.com/embed/{match.Groups[1].Value}" : null;
    }
}